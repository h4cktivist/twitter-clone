{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Index</title>

    {% if request.user.username %}
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript" src="{% static 'like.js' %}" defer></script>
    {% endif %}

    <script type="text/javascript" src="{% static 'sneak_block.js' %}" defer></script>

    <link rel="stylesheet" type="text/css" href="{% static 'index.css' %}">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

</head>

<body>

    <div id="poloska">

    <span>FeedBack</span>

</div>

    {% for message in messages %}
        <p>{{ message }}</p> <!-- Уведомление о новом посте -->
    {% endfor %}

    {% if form %}
        <!-- Post creation form -->
        <div class="post_create_form">

        <form enctype="multipart/form-data" method="post">

            <div id="form_block" style="height: 125px; max-height: 205px;">
            <label>
                {% csrf_token %}
                {{ form.text }}<br>
                {{ form.image }}
                <button type="submit" class="crp_button">Create post</button>

            </label>

            </div>

            <script type="text/javascript">
                let txtarea = document.getElementById('txtarea');
                let formblock = document.getElementById('form_block');

                function AutoSize(){
                    if (txtarea.value.length >= 356){
                        txtarea.style.height = parseInt(txtarea.style.height) + 90 + "px";
                        formblock.style.height = parseInt(formblock.style.height) + 80 + "px";
                    }
                    else if (txtarea.value.length == 0){
                        txtarea.style.height = 60 + "px";
                        formblock.style.height = 125 + "px";
                    }
                }
            </script>
        </form>
        </div>
    {% endif %}

    <br>

    <div id="user_menu">

    <div id="menu_btn" onclick="openMenu()">

            <span></span>
            <span></span>
            <span></span>

        </div>

        <ul>
            <li>Menu</li>
            <li><a href="{% url 'index' %}" style="color: #0075FF;">Home</a></li>
            <li><a href="{% url 'profile' %}">My Profile</a></li>
            <li><a href="{% url 'followers' %}">Followers</a></li>
        </ul>

        {% if request.user.username %}
            <div id="user_info">

                <img class="user_info_avatar" src="{{ request.user.profile.image.url }}">
                <a href="{% url 'profile' %}" id="user_info_name">{{ request.user.username }}</a>

            </div>
        {% endif %}

    </div>

    <div id="user_trends">

        <form action="{% url 'seacrh' %}" method="POST" id="form_search">

        <div id="form_search_block">
            {% csrf_token %}
             <input id="input_search" name="input_search" placeholder="Искать здесь..." type="search">

            <button id="button_search" type="submit">Поиск</button>

        </div>

        </form>
    </div>

    <div id="post_block">
    <!-- Posts -->

    {% for p in posts %}

        <div class="post_info">

                <img class="post_user_avatar" src="{{ p.user.profile.image.url }}">

                <a href="{% url 'otherprofile' p.user.username %}" id="post_username">{{ p.user }}</a>


        <span id="post_date">{{ p.publish_date }}</span>

        <br>

        <span id="post_text">{{ p.text }}</span>
        
        <a href="{% url 'detail' p.id %}" id="more">...More</a>

        <br>

        </div>

        <br>

        {% if p.image %}
        <div class="post_img_container">

            <img id="post_image" src="{{ p.image.url }}">

        </div>

        {% endif %}


       <!-- {% if p.was_published_recently %} 

            <p>New post!</p>

        {% endif %}

        -->

        <!-- Like button form -->

        <br>

        <form method="post" action="{% url 'like_post' %}" class="like-form" id="{{ p.id }}">

            {% csrf_token %}

            <input type="hidden" name="post_id" value="{{ p.id }}">

            <button type="submit" class="like-btn{{ p.id }}" id="like_btn">

                {% if user not in p.liked.all %}
                    Like
                {% else %}
                    Unlike
                {% endif %}
            </button>
             <span id="like_color">♥</span>
            <span class="like-count{{ p.id }}">{{ p.likes }}</span>

        </form>

        <hr>

    {% endfor %}

    </div>

</body>
</html>
